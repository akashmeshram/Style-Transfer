(()=>{"use strict";var e={187:e=>{var t,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,s){function o(n){e.removeListener(t,r),s(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}m(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,o)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var i=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,s){var o,r,i,c;if(l(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),i=r[t]),void 0===i)i=r[t]=n,++e._eventsCount;else if("function"==typeof i?i=r[t]=s?[n,i]:[i,n]:s?i.unshift(n):i.push(n),(o=a(e))>0&&i.length>o&&!i.warned){i.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=e,p.type=t,p.count=i.length,c=p,console&&console.warn&&console.warn(c)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=p.bind(s);return o.listener=n,s.wrapFn=o,o}function u(e,t,n){var s=e._events;if(void 0===s)return[];var o=s[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):f(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function m(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(r){s.once&&e.removeEventListener(t,o),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return a(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var l=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw l.context=i,l}var a=r[e];if(void 0===a)return!1;if("function"==typeof a)s(a,this,t);else{var c=a.length,p=f(a,c);for(n=0;n<c;++n)s(p[n],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return l(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,s,o,r,i;if(l(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){i=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,i||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,r=Object.keys(n);for(s=0;s<r.length;++s)"removeListener"!==(o=r[s])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}(()=>{var e=n(187);const t=["bricks","chicago","clouds","geometry","golden_gate","house","la_muse","matildeperez","matta","maturana","mountain","pollock","rain","rain_princess","red_circles","scream","seaport","sketch","stata","statue_of_liberty","stripes","towers","udnie","wave","wreak","zigzag"],s=["pexels-photo-1858175","pexels-photo-1933873","pexels-photo-2100063","pexels-photo-2128807","pexels-photo-2169434","pexels-photo-2379005","pexels-photo-2709388","pexels-photo-2741701","pexels-photo-2787341","pexels-photo-2846602","pexels-photo-3186558","pexels-photo-3220360","pexels-photo-3438086","pexels-photo-3671083","pexels-photo-3748221","pexels-photo-3981337","pexels-photo-415829","pexels-photo-4197932","pexels-photo-428364","pexels-photo-4556737","pexels-photo-4571943","pexels-photo-4612113","pexels-photo-4662950","pexels-photo-4993292","pexels-photo-5704849","pexels-photo-6015909","pexels-photo-6652928","pexels-photo-775358"],o="contentImg",r="styleImg",i="result";class l extends e.EventEmitter{constructor(){super(),this.predictionModel=null,this.transformModel=null,this.style=document.getElementById(r),this.content=document.getElementById(o),this.canvas=document.getElementById(i),this.contentBlending=.75,this.loadModels()}async loadModels(){this.emit("models-loading"),this.predictionModel=await tf.loadGraphModel("models/prediction/model.json"),this.transformModel=await tf.loadGraphModel("models/transform/model.json"),this.emit("models-loaded")}async applyStyle(){tf.engine().startScope(),await tf.nextFrame();const e=await this.runStylePredict(),t=await this.runStyleTransform(e);this.displayOutput(t),e.dispose(),t.dispose(),tf.engine().endScope()}async runStylePredict(){this.emit("style-loading"),await tf.nextFrame();const e=await tf.tidy((()=>this.predictionModel.predict(tf.browser.fromPixels(this.style).toFloat().div(tf.scalar(255)).expandDims())));return 1!==this.contentBlending?await this.blendContentStyle(e):e}async blendContentStyle(e){this.emit("style-blending"),await tf.nextFrame();const t=await tf.tidy((()=>this.predictionModel.predict(tf.browser.fromPixels(this.content).toFloat().div(tf.scalar(255)).expandDims()))),n=await tf.tidy((()=>{const n=tf.mul(e,tf.scalar(this.contentBlending)),s=tf.mul(t,tf.scalar(1-this.contentBlending));return tf.add(n,s)}));return e.dispose(),t.dispose(),n}async runStyleTransform(e){return this.emit("style-transforming"),await tf.nextFrame(),await tf.tidy((()=>this.transformModel.predict([tf.browser.fromPixels(this.content).toFloat().div(tf.scalar(255)).expandDims(),e]).squeeze()))}async displayOutput(e){await tf.browser.toPixels(e,this.canvas),this.emit("style-complete")}set styleStrength(e){this.contentBlending=e}set styleImage(e){this.style=document.getElementById(e)}}const a=l,c=(e,t)=>{const n=document.createElement("img");return n.src=`./img/${t}/${e}.webp`,n.alt=`${e} style image`,n.id=`style-${e}`,n};function p(e,t){e.addEventListener("input",(function(){if(this.files&&this.files[0]){const e=new FileReader;e.onload=function(e){t.contentImage=e.target.result},e.readAsDataURL(this.files[0])}}))}class d extends e.EventEmitter{constructor(){super(),this.uploadContent=document.getElementById("contentUpload"),this.uploadStyle=document.getElementById("styleUpload"),this.canvas=document.getElementById(i),this.styleGallery=document.getElementById("styleGallery"),this.contentGallery=document.getElementById("contentGallery"),this.style=document.getElementById(r),this.strengthBar=document.getElementById("stylized-strength"),this.content=document.getElementById(o),this.status=document.getElementById("status"),this.statusMessages=[{color:"black",message:"Click transfer to apply strength"},{color:"#f44336ff",message:"Style Processing ...."},{color:"red",message:"Style Applying ...."},{color:"green",message:"Stylize Complete !!!"}],this.loadStrengthBar(),this.loadUploadContent(),this.loadUploadStyle(),this.loadStyles(),this.loadContent(),this.setUpCanvas()}loadStrengthBar(){this.strengthBar.addEventListener("input",(e=>{this.emit("strength",e.target.value/100)}))}loadUploadContent(){p(this.uploadContent,this.contentImage)}loadUploadStyle(){p(this.uploadStyle,this.styleImage)}loadStyles(){t.sort((()=>.5-Math.random())).map((e=>{const t=c(e,"styles"),n=document.createElement("button");n.appendChild(t),n.addEventListener("click",(()=>{this.style.src=t.src})),this.styleGallery.appendChild(n)}))}loadContent(){s.sort((()=>.5-Math.random())).map((e=>{const t=c(e,"contents"),n=document.createElement("button");n.appendChild(t),n.addEventListener("click",(()=>{this.content.src=t.src})),this.contentGallery.appendChild(n)}))}setUpCanvas(){this.canvas.addEventListener("click",(()=>{const e=this.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),t=document.createElement("a");t.download="styled.png",t.href=e,t.click()}))}set contentImage(e){this.content.setAttribute("src",e)}set styleImage(e){this.style.setAttribute("src",e)}set statusCode(e){this.status.innerHTML=this.statusMessages[e].message}}const u=d,h=document.getElementById("transferBtn"),f=new u,m=new a;m.loadModels(),h.addEventListener("click",(()=>{m.applyStyle()})),f.on("strength",(e=>{m.styleStrength=e,f.statusCode=0})),m.on("style-loading",(()=>{f.statusCode=1})),m.on("style-complete",(()=>{f.statusCode=3}))})()})();